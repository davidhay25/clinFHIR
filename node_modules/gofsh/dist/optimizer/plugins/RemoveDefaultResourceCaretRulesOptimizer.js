"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const exportable_1 = require("../../exportable");
const lodash_1 = require("lodash");
exports.default = {
    name: 'remove_default_resource_caret_rules_optimizer',
    description: 'Remove caret rules on a Resource that provide values that will be provided by default SUSHI behavior',
    optimize(pkg) {
        // * ^abstract = false
        const DEFAULT_ABSTRACT = new exportable_1.ExportableCaretValueRule('');
        DEFAULT_ABSTRACT.caretPath = 'abstract';
        DEFAULT_ABSTRACT.value = false;
        // * ^type = {the Resource's id}
        const DEFAULT_TYPE = new exportable_1.ExportableCaretValueRule('');
        DEFAULT_TYPE.caretPath = 'type';
        // check for these on Resources
        pkg.resources.forEach(resource => {
            const ruleIndicesToRemove = [];
            DEFAULT_TYPE.value = resource.id;
            resource.rules.forEach((rule, idx) => {
                if (rule instanceof exportable_1.ExportableCaretValueRule &&
                    ((0, lodash_1.isEqual)(rule, DEFAULT_ABSTRACT) || (0, lodash_1.isEqual)(rule, DEFAULT_TYPE))) {
                    ruleIndicesToRemove.push(idx);
                }
            });
            if (ruleIndicesToRemove.length > 0) {
                (0, lodash_1.pullAt)(resource.rules, ...ruleIndicesToRemove);
            }
        });
    }
};
//# sourceMappingURL=RemoveDefaultResourceCaretRulesOptimizer.js.map