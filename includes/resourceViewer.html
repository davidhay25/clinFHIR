
<style>
    .myActive {
        background-color: red;
    }

    .modal-xlg{
        width:1200px;
    }
</style>

<script defer src="https://cloud.umami.is/script.js" data-website-id="383f5688-7293-4ac2-9dd3-b82e032bcc81"></script>

<uib-tabset  active="input.mainTabActive">
    <uib-tab heading="Resource explorer">

        <div class="row">

            <div class="col-md-2 col-sm-3">
                <h4>Resource Types</h4>
                <div class="myScroll600">
                    <div class="list-group">
                        <a href="#"  ng-click="typeSelected(type)"
                           ng-class="{'list-group-item':true,'active':type.type == outcome.selectedType}"
                           ng-repeat="type in outcome.resourceTypes ">
                            {{type.type}}
                            <span class="pull-right badge">{{type.bundle.total}}</span>
                        </a>
                    </div>
                </div>



                <span class="clickable" ng-click="copyToClipboard(downloadBundleText)">Copy Bundle to clipboard</span>

                <div>
                    <a ng-show="downloadBundleJsonName" download="{{downloadBundleJsonName}}.json"
                       href="{{downloadBundleJsonContent}}">Download Bundle</a>
                </div>




            </div>

            <div class="col-md-10 col-sm-9">
                <br/>
                <div class="row">
                    <div class="col-md-4 col-sm-4">

                        <div ng-show="outcome.selectedType">
                            <h4>{{outcome.selectedType}} resources
                                <span >
                            <a target="_blank"
                               class="pull-right badge"
                               ng-href="http://hl7.org/fhir/R4B/{{outcome.selectedType}}.html">Spec</a>
                            </span>
                            </h4>
                        </div>

                        <div class="myScroll1">
                            <div class="list-group">
                                <a href="#"
                                   ng-class="{'list-group-item':true,'active':entry.resource.id == outcome.selectedResource.id}"
                                   ng-repeat="entry in outcome.allResourcesOfOneType.entry">
                                    <div style="cursor: pointer" ng-click="resourceSelected(entry)">
                                        <ng-include src="'includes/resourceDisplayTemplates.html'"></ng-include>
                                    </div>
                                </a>
                            </div>
                        </div>



                    </div>


                    <div class="col-md-8 col-sm-8">



                        <div ng-show="outcome.selectedResource">

                            <div  ng-show="resourceVersions.entry.length > 1" class="alert alert-warning" style="margin-top: 8px">
                                <div class="row">
                                    <div class="col-md-10 col-sm-10">

                                        <ul class="pagination" style="margin-top:1px;margin-bottom:1px" ng-show="resourceVersions && resourceVersions.entry.length > 1">
                                            <li><a href="#"><strong>Versions:</strong></a></li>

                                            <li ng-repeat="ent in resourceVersions.entry">
                                                <a href="#" ng-click="selectVersion(ent.resource)">{{resourceVersions.entry.length - $index}}</a>
                                            </li>
                                        </ul>


                                    </div>
                                    <div class="col-md-2 col-sm-2">
                                        <button class="btn btn-link"
                                                ng-show="resourceVersions.entry.length > 1"
                                                ng-click="zoomResourceHistory(resourceVersions.entry)">Side-by-side</button>
                                    </div>



                                </div>





                            </div>

                            <div class="alert alert-danger" ng-show="outcome.selectedResource.modifierExtension">
                                This resource has Modifier Extensions. They can be viewed in the extension tab below.
                            </div>
                            <div class="row">
                                <div class="col-md-8 col-sm-8">

                                    <uib-tabset  active="input.secondaryTabActive">

                                        <uib-tab heading="References" select="fitGraphInContainer('resourcenetwork')">
                                            <div id="resourcenetwork"></div>
                                            <em>Double click to change the focus resource, or click in the references lists.</em>
                                        </uib-tab>

                                        <uib-tab heading="Tree">
                                            <div class="myScroll1">
                                                <div  class="white" id="resourceTree"></div>
                                            </div>


                                        </uib-tab>
                                        <uib-tab heading="Text" >
                                            <p class="white" ng-bind-html="outcome.selectedResource.text.div"></p>
                                        </uib-tab>
                                        <uib-tab heading="Json">
                                            <!--
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <h4>{{outcome.selectedResource.resourceType}}/{{outcome.selectedResource.id}}</h4>
                                                </div>

                                            </div>
                                            -->

                                            <pre>{{outcome.selectedResource | json:2}}</pre>
                                        </uib-tab>

                                        <uib-tab ng-show="outcome.selectedResource.extension || outcome.selectedResource.modifierExtension" heading="Extensions">

                                            <div ng-show="outcome.selectedResource.modifierExtension">
                                                <div><strong>Modifier extensions</strong></div>
                                                <pre>{{outcome.selectedResource.modifierExtension | json}}</pre>
                                            </div>


                                            <div ng-show="outcome.selectedResource.extension">
                                                <div><strong>Extensions</strong></div>
                                                <pre>{{outcome.selectedResource.extension | json}}</pre>
                                            </div>



                                        </uib-tab>

                                        <uib-tab ng-show="false" heading="XML">

                                            <div class="row">
                                                <div class="col-md-10 col-sm-10">
                                                    <h4>{{outcome.selectedResource.resourceType}}/{{outcome.selectedResource.id}}</h4>
                                                </div>
                                                <div class="col-md-2 col-sm-2">
                                                    <!--
                                                    <a class="pull-right" download="{{downloadLinkXmlName}}" href="{{downloadLinkXmlContent}}">Download</a>
                                                    -->
                                                </div>
                                            </div>


                                            <pre>{{xmlResource}}</pre>
                                        </uib-tab>


                                        <uib-tab heading="Display"
                                                 ng-show="hasDetailedView.indexOf(outcome.selectedResource.resourceType) > -1">


                                            <ng-include ng-show="outcome.selectedResource.resourceType=='Observation'"
                                                        src="'./displayTemplates/observation.html'"></ng-include>

                                            <ng-include ng-show="outcome.selectedResource.resourceType=='Encounter'"
                                                        src="'./displayTemplates/encounter.html'"></ng-include>

                                            <ng-include ng-show="outcome.selectedResource.resourceType=='Condition'"
                                                        src="'./displayTemplates/condition.html'"></ng-include>


                                        </uib-tab>



                                        <uib-tab heading="Task " ng-show="outcome.selectedResource.resourceType=='Task'">
                                            <br/>
                                            <div ng-controller="pvTaskCtrl">
                                                <ng-include src="'includes/pvTask.html'"></ng-include>
                                            </div>
                                        </uib-tab>


                                        <uib-tab heading="Sections" ng-show="outcome.selectedResource.resourceType=='Composition'">

                                            <div class="myScroll1">

                                                <div ng-repeat = "section in outcome.selectedResource.section">
                                                    <h5>{{section.title}}
                                                        (<span ng-repeat = "code in section.code.coding">{{code.code}}</span>)
                                                    </h5>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div style="margin-left: 10px">

                                                                <div ng-repeat = "entry in section.entry">
                                                                   <!-- {{entry.reference}} -->
                                                                    <div  style="padding: 5px; cursor: pointer" ng-click="selectResourceFromSection(getResourceTextFromReference(entry.reference).resource)">
                                                                        {{getResourceTextFromReference(entry.reference).text}}
                                                                    </div>

                                                                </div>

                                                            </div>
                                                        </div>
                                                        <!--
                                                        <div class="col-sm-4 col-md-4">

                                                            <div class="pull-right clickable"
                                                                 ng-click="showText(section)">View Text</div>

                                                        </div>
                                                        -->
                                                    </div>

                                                </div>
                                            </div>
                                        </uib-tab>

                                    </uib-tabset>

                                </div>

                                <div class="col-md-4 col-sm-4">
                                    <div class="myScroll1">
                                        <h4>Outward references</h4>

                                        <div class="list-group">
                                            <a href="#"class="list-group-item"
                                               ng-repeat="reference in resourceReferences.outwardLinks"
                                               ng-click="selectNewResource(reference,$event)">

                                                {{reference.reference}}
                                                <div><em>{{reference.key}}</em></div>
                                            </a>
                                        </div>

                                        <h4>Inward references</h4>

                                        <div class="list-group">
                                            <a href="#" class="list-group-item"
                                               ng-repeat="reference in resourceReferences.inwardLinks"
                                               ng-click="selectNewResource(reference,$event)">

                                                <div>{{reference.resource.resourceType}}/{{reference.resource.id}}
                                                </div>
                                                <div><em>{{reference.name}}</em></div>
                                                <div><p ng-bind-html="reference.resource.text.div"></p></div>

                                            </a>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>




        </div>



    </uib-tab>

    <uib-tab heading="Resource references graph"  select="fitGraphInContainer('mynetwork')">
        <br/>

        <div class="row">
            <div class="col-md-2 col-sm-2">
                <h3>Resource filter</h3>
                <div ng-repeat = "(k,v) in allResources">
                    <checkbox ng-model="input.showType[k]" ng-change="setShowType(k,input.showType[k])"/> {{k}}

                </div>
                <!--
                                <div class="pull-right clickable" ng-click="showPatientInGraph()">
                                    <span ng-hide="patientShown">Show Patient</span>
                                    <span ng-show="patientShown">Hide Patient</span>

                                </div>

                                -->


                <br/>
                <button class="btn btn-link" ng-click="updateFilter(false)">Hide all</button>
                <button class="btn btn-link" ng-click="updateFilter(true)">Show all</button>


            </div>
            <div class="col-md-6 col-sm-6">
                <div id="mynetwork"></div>
                <em>Click a resource to see details in the right pane. Double click to show in the Resource explorer. Scroll to zoom the display (with the mouse in the graph)</em>


            </div>
            <div class="col-md-4 col-sm-4">
                <uib-tabset>
                    <uib-tab heading="Tree">
                        <div class="myScroll1">
                            <div id="graphResourceTree"></div>
                        </div>

                    </uib-tab>
                    <uib-tab heading="Text">
                        <p ng-bind-html="selectedGraphNode.resource.text.div"></p>
                    </uib-tab>
                    <uib-tab heading="Json">
                        <pre>{{selectedGraphNode.resource | json}}</pre>
                    </uib-tab>
                </uib-tabset>


            </div>
        </div>


    </uib-tab>

    <uib-tab heading="Terminology explorer" >
        <br/>


        <div ng-controller="terminologyExplorerCtrl">
            <ng-include src="'includes/terminologyExplorer.html'"></ng-include>
        </div>





    </uib-tab>

    <uib-tab heading="Numeric Observations/Vitals" >
        <br/>
        <div ng-controller="observationsDisplayCtrl">
            <div class="row">
                <div class="col-md-3">
                    <div class="list-group">
                        <a href="#"  ng-click="obsSelected(key,value)"
                           ng-class="{'list-group-item':true,'active':1==2}"
                           ng-repeat="(key,value) in observations ">
                            {{value.display}}
                            <span class="pull-right badge">{{value.list.length}}</span>
                        </a>
                    </div>


                    <!-- Show the vitals if there are any observations-->

                    <div ng-show="hasVitals">
                        <div class="rounded-box">
                            <div class="list-group">
                                <a href="#" class="list-group-item" ng-click="getVitals()">
                                    <span ng-hide="vitalsTable">Show Vitals</span>
                                    <span ng-show="vitalsTable">Hide Vitals</span>
                                </a>
                            </div>



                        </div>

                    </div>


                </div>
                <div class="col-md-9">
                    <div ng-hide="observations">
                        <p>This patient has no numeric observations (where Observation.valueQuantity has a value).</p>
                    </div>

                    <!-- The vitals table -->
                    <table class="table table-bordered" ng-show="vitalsTable">
                        <tr>
                            <td>Item</td>
                            <td ng-repeat="date in vitalsTable.dates track by $index">
                                <div>{{date | date : 'dd-MMM-yy hh:mm'}}</div>
                                <div>{{date | getAge}}</div>
                            </td>
                        </tr>

                        <tr ng-repeat="row in vitalsTable.rows track by $index" >
                            <td title="{{row.code}}">{{row.display}}  ({{row.unit}})</td>

                            <td ng-repeat="item in row.cols track by $index">
                                {{item.value}}
                            </td>
                        </tr>
                    </table>

                    <div ng-show="observations">
                        <div style="width: 100%; height: 300px; border: 1px solid lightgray;"
                             id="observationsChart"></div>

                    </div>




                </div>

            </div>



        </div>
    </uib-tab>

    <uib-tab heading="Encounter timeline">
        <br/>
        <div class="row">
            <div class="col-md-2 col-sm-2">
                <div style="height: 700px; overflow-y: scroll;">
                    <div class="list-group">
                        <a href="#" class="list-group-item" ng-click="filterTimeLineByCondition()">All Conditions</a>
                        <a href="#" class="list-group-item"
                           ng-click="filterTimeLineByCondition(key)"
                           ng-repeat="(key,item) in conditions">

                            <span class="pull-right badge">{{item.count}}</span>
                            {{ResourceUtilsSvc.getOneLineSummaryOfResource(item.resource)}}

                        </a>
                    </div>
                </div>
            </div>


            <div class="col-md-10 col-sm-10">
                <div id="encTimeline"></div>
                <hr />

                <div ng-show="outcome.selectedResource">
                    <div class="banner">
                        <strong>Encounter:</strong> {{outcome.selectedResource.id}}
                    </div>



                    <uib-tabset>
                        <uib-tab heading="Display">



                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <ng-include ng-show="outcome.selectedResource.resourceType=='Encounter'"
                                                src="'./displayTemplates/encounter.html'"></ng-include>
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <pre>{{outcome.selectedResource | json}}</pre>
                                </div>

                            </div>


                        </uib-tab>

                        <uib-tab heading="References/Json" select="fitGraphInContainer('resourcenetworkgraphtl')">
                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <div style="width: 100%; height: 400px; border: 1px solid lightgray;"
                                         id="resourcenetworkgraphtl"></div>
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <pre>{{outcome.selectedResource | json}}</pre>
                                </div>

                            </div>
                        </uib-tab>

                    </uib-tabset>


                </div>

            </div>

        </div>


    </uib-tab>

    <uib-tab ng-show="document" heading="Document">
        <ng-include src="'includes/pvDocument.html'"></ng-include>

    </uib-tab>



    <uib-tab heading="FHIRPath">
        <br/>
        <div class="row">
            <div class="col-md-2">

                <uib-tabset>
                    <uib-tab heading="By Type">
                        <br/>
                        <uib-accordion>

                            <div uib-accordion-group class="panel-default" heading="{{key}}"
                                 ng-show = "value.entry.length > 0"
                                 ng-repeat="(key,value)  in allResources">
                                <ul class="list-group">
                                    <li ng-class="{'list-group-item':1==1,'list-group-item-info':entry.resource.id == outcome.selectedResource.id}"
                                        style = "cursor: pointer"
                                        ng-repeat = "entry in value.entry" ng-click="selectFPResource(entry)">
                                        <ng-include src="'includes/resourceDisplayTemplates.html'"></ng-include>

                                    </li>
                                </ul>

                            </div>

                        </uib-accordion>
                    </uib-tab>
                    <uib-tab heading="Bundle">
                        <br/>
                        <div class="row">



                            <div class="col-sm-12 col-md-12">
                                <span class="clickable pull-right" ng-click="selectSingleBundle(singleBundle)">Show Bundle</span>
                            </div>

                        </div>

                        <strong>Entries</strong>
                        <div style="height: 700px; overflow-y: scroll;">
                            <ul class="list-group">

                                <li ng-class="{'list-group-item':1==1,'list-group-item-info':entry.resource.id == outcome.selectedResource.id}"
                                    style = "cursor: pointer"
                                    ng-repeat = "entry in singleBundle.entry" ng-click="selectFPResource(entry)">
                                    <ng-include src="'includes/resourceDisplayTemplates.html'"></ng-include>

                                </li>
                            </ul>
                        </div>




                    </uib-tab>
                </uib-tabset>



            </div>

            <div class="col-md-5 col-sm-5">
                <strong>Source for FHIRPath evaluation</strong>
                <pre>{{fpResource | json}}</pre>
                <div ng-hide="fpResource">
                    <p>Please select a resource to the left to evaluate the FHIRPath expression on. </p>
                    <ul>
                        <li>From the 'By type' tab you can select the resource type, then a single resource instance</li>
                        <li>The 'Bundle' tab allows you to select a resource from the bundle, or the bundle itself - in
                        which case the FHIRPath operates on the bundle as a whole.</li>
                    </ul>

                </div>
            </div>

            <div class="col-md-5 col-sm-5">
                <fhirpath resource="fpResource"></fhirpath>
                <em>This will query the resource shown in the middle pane. Click 'Show Bundle' for full bundle queries.</em>
            </div>

        </div>


    </uib-tab>

    <uib-tab ng-show="false" heading="Json">
        <pre>{{}}</pre>
    </uib-tab>

    <uib-tab ng-show="showGQL" heading="GraphQL">
        <br/>
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <graphql resource="currentPatient"></graphql>
            </div>
        </div>
    </uib-tab>

    <uib-tab  ng-show="false && documentReferenceList.length > 0" heading="Graphs">

        <div class="row">

            <div class="col-md-2 col-sm-2">
                <h4>Graphs</h4>
                <div class="list-group">
                    <a href="#"  ng-click="selectDocument(entry.resource)"
                       ng-class="{'list-group-item':true,'active':documentReference.id == entry.resource.id}"
                       ng-repeat="entry in documentReferenceList">
                        {{entry.resource.description}}
                    </a>
                </div>
            </div>
<!--

            -->
            <div class="col-md-10 col-sm-10">
                <br/>



                <div class="row" ng-show="documentReference">
                    <div class="col-md-8 col-sm-8">
                        <br/>

                        <uib-tabset>
                            <uib-tab heading="Graph">
                                <div  style="width: 100%; height: 500px; border: 1px solid lightgray;" id="graphGraph"></div>
                            </uib-tab>

                            <uib-tab ng-show="graphNotes" heading="Notes">
                                <p ng-bind-html="graphNotes | markDown"></p>


                            </uib-tab>
                        </uib-tabset>


                    </div>



                    <div class="col-md-4 col-sm-4">
                        <uib-tabset>
                            <uib-tab heading="Tree">
                                <div id="graphGraphResourceTree"></div>
                            </uib-tab>
                            <uib-tab heading="Json">
                                <pre>{{selectedGraphResource | json}}</pre>
                            </uib-tab>
                        </uib-tabset>

                    </div>
                </div>



            </div>


        </div>




    </uib-tab>

    <uib-tab ng-show="false" heading="Questionnaires">

        <div class="row">

            <div class="col-md-2 col-sm-2">
                <h4>Questionnaires</h4>
                <div class="list-group">
                    <a href="#"  ng-click="selectQ(entry.resource)"
                       ng-class="{'list-group-item':true,'active':currentQ.id == entry.resource.id}"
                       ng-repeat="entry in QBundle.entry">
                        {{entry.resource.id}}
                    </a>
                </div>
            </div>

            <div class="col-md-10 col-sm-10">
                <br/>
                <questionnaire model="currentQ" resourcehash="allResources"></questionnaire>
            </div>
        </div>
    </uib-tab>




</uib-tabset>


